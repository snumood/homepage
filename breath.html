<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>분당서울대학교병원 기분장애클리닉</title>

    <!-- Tailwind & Font -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

    <style>
        /* =========================
           GLOBAL
        ========================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            color: #212121;
            line-height: 1.5;
            padding-top: 70px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* =========================
           HEADER & NAV (index.html과 동일)
        ========================= */
        #main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.07);
            z-index: 1000;
            display: flex;
            justify-content: center;
            height: 70px;
        }

        .header-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px;
        }

        .logo {
            font-size: 1.15rem;
            font-weight: 700;
            color: #002171;
            text-decoration: none;
            letter-spacing: -0.5px;
            white-space: nowrap;
        }

        #main-nav {
            display: flex;
        }

        #main-nav ul {
            display: flex;
            list-style: none;
        }

        #main-nav li {
            margin-left: 20px;
        }

        #main-nav a {
            text-decoration: none;
            color: #5a5a5a;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 24px 0;
            border-bottom: 3px solid transparent;
            transition: color 0.3s, border-color 0.3s;
            white-space: nowrap;
        }

        #main-nav a:hover,
        #main-nav a.active {
            color: #0d47a1;
            border-bottom-color: #42a5f5;
        }

        #mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
        }

        #mobile-menu-toggle .bar {
            display: block;
            width: 25px;
            height: 3px;
            background-color: #0d47a1;
            margin: 5px 0;
            transition: all 0.3s ease-in-out;
            border-radius: 2px;
        }

        @media (max-width: 1024px) {
            body {
                padding-top: 60px;
            }

            #main-header {
                height: 60px;
            }

            #main-nav {
                position: fixed;
                top: 60px;
                left: 0;
                width: 100%;
                height: calc(100vh - 60px);
                background: #ffffff;
                flex-direction: column;
                align-items: center;
                padding-top: 10px;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                border-top: 1px solid #e0e0e0;
                overflow-y: auto;
            }

            #main-nav.is-active {
                transform: translateX(0);
            }

            #main-nav ul {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
            }

            #main-nav li {
                margin: 0;
                width: 100%;
            }

            #main-nav a {
                font-size: 1.1rem;
                padding: 16px 25px;
                display: block;
                border-bottom: 1px solid #e0e0e0;
            }

            #main-nav a:hover,
            #main-nav a.active {
                background-color: #e3f2fd;
                color: #0d47a1;
                border-bottom-color: #e0e0e0;
            }

            #mobile-menu-toggle {
                display: block;
            }

            #mobile-menu-toggle.is-active .bar:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }

            #mobile-menu-toggle.is-active .bar:nth-child(2) {
                opacity: 0;
            }

            #mobile-menu-toggle.is-active .bar:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }
        }

        /* =========================
           APP LAYOUT
        ========================= */
        .app-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 70px);
            padding: 20px;
        }

        .breathing-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 30px;
            width: 550px;
            max-width: 100%;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.05);
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>

<!-- =========================
     HEADER
========================= -->
<header id="main-header">
    <div class="header-container">
        <a href="https://snumood.github.io/homepage/" class="logo">
            분당서울대학교병원 기분장애클리닉
        </a>

        <nav id="main-nav">
            <ul>
                <li><a href="https://snumood.github.io/homepage/#surveys">설문지 작성</a></li>
                <li><a href="https://snumood.github.io/homepage/#results">설문결과 확인</a></li>
                <li><a href="https://snumood.github.io/homepage/ls.html">생활습관 점수표</a></li>
                <li><a href="https://snumood.github.io/homepage/mssi.html">기분안정성평가 설문지</a></li>
                <li><a href="https://snumood.github.io/homepage/#mood-chart">기분 기록지</a></li>
                <li><a href="#" class="active">마음안정화 훈련 (호흡/이완)</a></li>
                <li><a href="https://snumood.github.io/homepage/#mindfulness">마음챙김</a></li>
                <li><a href="https://snumood.github.io/homepage/#workbook">워크북</a></li>
                <li><a href="https://snumood.github.io/homepage/#research">연구 성과</a></li>
            </ul>
        </nav>

        <button id="mobile-menu-toggle" aria-label="메뉴 열기">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>
    </div>
</header>

<!-- =========================
     MAIN
========================= -->
<main class="app-wrapper">
    <div class="breathing-card">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-8 text-center tracking-tight">
            편안한 호흡
        </h1>

        <div class="relative flex flex-col items-center justify-center w-full max-w-sm aspect-square mb-6">
            <canvas id="breathingCanvas" class="w-full h-full"></canvas>
            <div id="instructionText"
                 class="absolute text-4xl sm:text-5xl font-bold text-center w-full top-1/2 left-1/2 
                        -translate-x-1/2 -translate-y-1/2 transition-all duration-700 
                        pointer-events-none tracking-tight"></div>
            <div id="countdownText"
                 class="absolute text-3xl font-bold text-gray-600 top-[68%] left-1/2 
                        -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
        </div>

        <p class="text-center text-gray-600 mt-4 text-base font-bold">
            원의 움직임에 맞춰 호흡하세요.
        </p>

        <div id="timerDisplay"
             class="mt-4 text-lg font-bold text-blue-600 bg-blue-50 px-6 py-1 rounded-full border border-blue-100">
            연습 시간: 00:00
        </div>
    </div>
</main>

<!-- =========================
     SCRIPT
========================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const navMenu = document.getElementById('main-nav');
    const navLinks = navMenu.querySelectorAll('a');

    menuToggle.addEventListener('click', function () {
        menuToggle.classList.toggle('is-active');
        navMenu.classList.toggle('is-active');
    });

    navLinks.forEach(link => {
        link.addEventListener('click', function () {
            if (navMenu.classList.contains('is-active')) {
                menuToggle.classList.remove('is-active');
                navMenu.classList.remove('is-active');
            }
        });
    });
});

/* ===== 기존 호흡 애니메이션 로직 (변경 없음) ===== */
const canvas = document.getElementById('breathingCanvas');
const ctx = canvas.getContext('2d');
const instructionText = document.getElementById('instructionText');
const countdownText = document.getElementById('countdownText');
const timerDisplay = document.getElementById('timerDisplay');

let startTime = 0;
let currentPhaseStartTime = 0;
let phase = 'inhale';

const INHALE_DURATION = 5000;
const HOLD_DURATION = 1000;
const EXHALE_DURATION = 8000;

let centerX, centerY, maxRadius, minRadius;

function initializeCanvas() {
    const size = Math.min(canvas.parentElement.offsetWidth, canvas.parentElement.offsetHeight);
    const dpr = window.devicePixelRatio || 1;
    canvas.width = size * dpr;
    canvas.height = size * dpr;
    canvas.style.width = `${size}px`;
    canvas.style.height = `${size}px`;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    centerX = size / 2;
    centerY = size / 2;
    maxRadius = (size / 2) * 0.75;
    minRadius = maxRadius * 0.4;
}

function animate(timestamp) {
    if (!startTime) startTime = currentPhaseStartTime = timestamp;
    const elapsedTotal = timestamp - startTime;
    const elapsedPhase = timestamp - currentPhaseStartTime;

    const totalSeconds = Math.floor(elapsedTotal / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    timerDisplay.textContent =
        `연습 시간: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

    let radius;

    if (phase === 'inhale') {
        const t = Math.min(1, elapsedPhase / INHALE_DURATION);
        radius = minRadius + (maxRadius - minRadius) * t;
        instructionText.textContent = '들이쉬기';
        countdownText.textContent = Math.ceil((INHALE_DURATION - elapsedPhase) / 1000);
    } else if (phase === 'hold1') {
        radius = maxRadius;
        instructionText.textContent = '';
        countdownText.textContent = '';
    } else if (phase === 'exhale') {
        const t = Math.min(1, elapsedPhase / EXHALE_DURATION);
        radius = maxRadius - (maxRadius - minRadius) * t;
        instructionText.textContent = '내쉬기';
        countdownText.textContent = Math.ceil((EXHALE_DURATION - elapsedPhase) / 1000);
    } else {
        radius = minRadius;
        instructionText.textContent = '';
        countdownText.textContent = '';
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(59,130,246,0.25)';
    ctx.fill();

    if (phase === 'inhale' && elapsedPhase >= INHALE_DURATION) {
        phase = 'hold1'; currentPhaseStartTime = timestamp;
    } else if (phase === 'hold1' && elapsedPhase >= HOLD_DURATION) {
        phase = 'exhale'; currentPhaseStartTime = timestamp;
    } else if (phase === 'exhale' && elapsedPhase >= EXHALE_DURATION) {
        phase = 'hold2'; currentPhaseStartTime = timestamp;
    } else if (phase === 'hold2' && elapsedPhase >= HOLD_DURATION) {
        phase = 'inhale'; currentPhaseStartTime = timestamp;
    }

    requestAnimationFrame(animate);
}

window.addEventListener('resize', initializeCanvas);
window.addEventListener('load', () => {
    initializeCanvas();
    requestAnimationFrame(animate);
});
</script>

</body>
</html>
